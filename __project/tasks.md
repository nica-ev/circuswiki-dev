# Tasks for Enhancing CircusWiki Technical Manual

Based on the review of `_inbox/CircusWiki - Technical Manual.md`:

- [X] Add a brief executive summary or "TL;DR" section at the beginning of the manual for a quick overview.
- [ ] Consider adding relevant screenshots (e.g., website search, game page example, Obsidian interface, GitHub PR process) to visually aid understanding.
- [ ] Explicitly link to or embed the detailed metadata schema definition mentioned in Section 5.3 within the manual.
    - [X] add a note with the metadata schema (metadata schema.md)
- [X] Explicitly mention the `requirements.txt` file (if it exists) in Section 9.1 (Offline Browsing) for installing dependencies.
- [ ] Rework the placeholder note in Section 8.6 ("==rework this section, mention photo process with CircA==") regarding the simplified contribution process, particularly the photo aspect.
- [ ] Briefly elaborate on the nature or types of content within the "~800 notes" backlog mentioned in Section 7 (Current Content Scope). 


---


| ID    | Title                                                               | Description                                                                                     | Status  | Dependencies | Details Summary                                                                                                      |
| :---- | :------------------------------------------------------------------ | :---------------------------------------------------------------------------------------------- | :------ | :----------- | :------------------------------------------------------------------------------------------------------------------- |
| **1** | **Set up project structure and configuration loading**              | **Create the initial project structure and implement the ConfigLoader component...**            | pending | -            | -                                                                                                                    |
| 1.1   | Create project directory structure and placeholder files            | Set up the initial project structure with all required files and directories                    | pending | -            | _(No details provided)_                                                                                              |
| 1.2   | Implement environment variable loading from translate.env           | Create functionality to load API keys from translate.env using python-dotenv                  | pending | 1.1          | _(No details provided)_                                                                                              |
| 1.3   | Implement settings.txt parsing and validation                       | Create functionality to parse and validate configuration from settings.txt                      | pending | 1.1          | _(No details provided)_                                                                                              |
| 1.4   | Integrate configuration components and create public interface      | Combine environment and settings loading, and create a clean interface for accessing config...  | pending | 1.2, 1.3     | _(No details provided)_                                                                                              |
| **2** | **Implement FileManager for directory scanning and file operations**| **Create the FileManager component to scan directories for Markdown files and handle basic...** | pending | 1            | -                                                                                                                    |
| 2.1   | Implement basic FileManager class structure with directory scanning | Create the FileManager class with initialization and recursive directory scanning...            | pending | -            | _(No details provided)_                                                                                              |
| 2.2   | Implement file reading and writing methods                          | Add methods to read from and write to files with appropriate error handling                     | pending | 2.1          | _(No details provided)_                                                                                              |
| 2.3   | Implement output directory creation functionality                   | Add method to create necessary subdirectories in OUTPUT_DIR                                     | pending | 2.1          | _(No details provided)_                                                                                              |
| 2.4   | Implement output path construction and file existence checks        | Add helper methods to construct output file paths and check file existence                      | pending | 2.1, 2.3     | _(No details provided)_                                                                                              |
| **3** | **Develop YAML frontmatter extraction and processing**              | **Implement functionality to extract, parse, and manipulate YAML frontmatter...**               | pending | 2            | -                                                                                                                    |
| 3.1   | Create YAMLFrontmatter class with extraction functionality          | Implement a YAMLFrontmatter class that can extract YAML frontmatter from Markdown files         | pending | -            | _(No details provided)_                                                                                              |
| 3.2   | Implement frontmatter parsing and validation                        | Add functionality to parse extracted frontmatter and validate its structure                     | pending | 3.1          | _(No details provided)_                                                                                              |
| 3.3   | Add frontmatter field analysis functionality                        | Implement methods to analyze frontmatter fields for translation needs                         | pending | 3.2          | _(No details provided)_                                                                                              |
| 3.4   | Implement frontmatter update methods                                | Create methods to update frontmatter with new values while preserving formatting                | pending | 3.3          | _(No details provided)_                                                                                              |
| 3.5   | Implement frontmatter serialization and integration...              | Add functionality to serialize updated frontmatter back to YAML and integrate...                | pending | 3.4          | _(No details provided)_                                                                                              |
| **4** | **Implement hash calculation and change detection**                 | **Create functionality to calculate content and YAML hashes and implement the change...**       | pending | 3            | -                                                                                                                    |
| 4.1   | Implement content and YAML hash calculation methods                 | Create methods to calculate SHA-256 hashes for both content and YAML frontmatter              | pending | -            | _(No details provided)_                                                                                              |
| 4.2   | Implement hash comparison logic                                     | Create functionality to compare calculated hashes with stored hashes from frontmatter           | pending | 4.1          | _(No details provided)_                                                                                              |
| 4.3   | Implement change detection workflow                                 | Create the main logic to determine processing needs based on hash differences                   | pending | 4.1, 4.2     | _(No details provided)_                                                                                              |
| 4.4   | Implement hash update functionality                                 | Add methods to update source file frontmatter with new hash values                            | pending | 4.1, 4.2, 4.3 | _(No details provided)_                                                                                              |
| **5** | **Develop Markdown parsing and content extraction**                 | **Implement the core Markdown parsing functionality to extract translatable text...**           | pending | 4            | Extend the MarkdownProcessor class to use markdown-it-py, traverse AST, handle WikiLinks...                            |
| 5.1   | Set up markdown-it-py parser with extensions                        | Initialize the MarkdownProcessor class with markdown-it-py and configure it...                | pending | -            | Implementation details: Install markdown-it-py...                                                                    |
| 5.2   | Implement AST traversal and text segment extraction                 | Develop methods to traverse the Markdown AST and identify translatable text segments...         | pending | 5.1          | Implementation details: Create a recursive traversal method...                                                       |
| 5.3   | Add special handling for Obsidian-style WikiLinks                   | Extend the parser to properly handle Obsidian-style WikiLinks while preserving...             | pending | 5.2          | Implementation details: Research and understand the format of Obsidian WikiLinks...                                |
| 5.4   | Implement YAML frontmatter extraction                               | Add functionality to parse and extract translatable content from YAML frontmatter...            | pending | 5.1          | Implementation details: Add detection for YAML frontmatter blocks...                                                 |
| 5.5   | Integrate extraction components and implement segment aggregation   | Combine all extraction methods and implement functionality to aggregate translatable segments...| pending | 5.2, 5.3, 5.4 | Implementation details: Create a main extraction method...                                                           |
| **6** | **Implement TranslationService with DeepL integration**             | **Create the TranslationService component with initial support for DeepL API and test mode.**   | pending | 5            | -                                                                                                                    |
| 6.1   | Create TranslationService interface and provider abstraction        | Define the core interfaces for the translation service and provider pattern                   | pending | -            | _(No details provided)_                                                                                              |
| 6.2   | Implement DeepLTranslator provider                                  | Create the concrete implementation of the translation provider for DeepL API                  | pending | 6.1          | _(No details provided)_                                                                                              |
| 6.3   | Implement TranslationService core functionality                     | Create the main service implementation that orchestrates translation requests                 | pending | 6.1, 6.2     | _(No details provided)_                                                                                              |
| 6.4   | Add TEST_MODE functionality                                         | Implement test mode that returns original text without API calls                              | pending | 6.3          | _(No details provided)_                                                                                              |
| 6.5   | Implement error handling and resilience                             | Add comprehensive error handling, retries, and graceful degradation                           | pending | 6.2, 6.3, 6.4 | _(No details provided)_                                                                                              |
| **7** | **Develop Markdown reconstruction logic**                           | **Implement functionality to reconstruct Markdown content by replacing original text...**       | pending | 6            | Extend the MarkdownProcessor class to replace segments using mapping, ensure formatting preserved...               |
| 7.1   | Implement segment replacement core logic                            | Create the foundation for replacing original text segments with translated versions...          | pending | -            | Extend the MarkdownProcessor class with a new method (e.g., replaceSegments)...                                      |
| 7.2   | Develop AST traversal for reconstruction                            | Create functionality to traverse the AST and reconstruct Markdown with translations applied     | pending | 7.1          | Implement a method to traverse the parsed AST/token stream and rebuild the Markdown content...                   |
| 7.3   | Implement preservation of non-translatable elements                 | Ensure code blocks, HTML, URLs, and other non-translatable elements remain untouched            | pending | 7.2          | Enhance the reconstruction logic to explicitly identify and preserve non-translatable elements...                |
| 7.4   | Handle complex Markdown structures                                  | Implement special handling for tables, lists, and nested elements                               | pending | 7.2, 7.3     | Extend the reconstruction logic with specialized handling for complex Markdown structures...                       |
| 7.5   | Implement edge case handling and validation                         | Add robust handling for edge cases and validation of the reconstructed output                   | pending | 7.1..7.4     | Implement handling for edge cases such as empty translations, modified segment boundaries...                     |
| **8** | **Implement output file generation with proper frontmatter**        | **Create functionality to generate translated output files with appropriate frontmatter.**      | pending | 7            | -                                                                                                                    |
| 8.1   | Extend FileManager to handle output file paths...                   | Modify the FileManager class to construct output file paths based on target language...         | pending | -            | _(No details provided)_                                                                                              |
| 8.2   | Implement frontmatter translation and preservation logic            | Create functionality to selectively translate frontmatter fields while preserving...            | pending | -            | _(No details provided)_                                                                                              |
| 8.3   | Create output file writing functionality                            | Implement methods to write the processed frontmatter and translated content to output files.  | pending | 8.1          | _(No details provided)_                                                                                              |
| 8.4   | Integrate components for complete output file generation            | Connect all components to create a complete workflow for generating translated output files...| pending | 8.1, 8.2, 8.3 | _(No details provided)_                                                                                              |
| **9** | **Implement special handling for YAML-only updates**                | **Add functionality to handle the case where only YAML frontmatter needs updating.**          | pending | 8            | -                                                                                                                    |
| 9.1   | Implement YAML change detection mechanism                           | Create functionality to detect when only YAML frontmatter has changed between source...         | pending | -            | _(No details provided)_                                                                                              |
| 9.2   | Add selective YAML frontmatter extraction and updating              | Create methods to extract YAML from existing files and generate updated frontmatter...        | pending | 9.1          | _(No details provided)_                                                                                              |
| 9.3   | Implement YAML-only file update workflow                            | Create the main workflow for updating only YAML frontmatter in translated files                 | pending | 9.1, 9.2     | _(No details provided)_                                                                                              |
| 9.4   | Integrate YAML-only optimization into main processing flow          | Modify the main processing flow to use YAML-only updates when appropriate                     | pending | 9.3          | _(No details provided)_                                                                                              |
| **10**| **Implement main workflow and error handling**                      | **Create the main program workflow that ties all components together and implement...**         | pending | 9            | -                                                                                                                    |
| 10.1  | Implement basic program structure and component initialization      | Create the main.py file with the basic structure and initialization of all required components| pending | -            | _(No details provided)_                                                                                              |
| 10.2  | Implement core workflow sequence                                    | Implement the main workflow sequence that processes files according to the PRD                  | pending | 10.1         | _(No details provided)_                                                                                              |
| 10.3  | Implement file processing and translation logic                     | Implement the detailed file processing logic including translation service integration          | pending | 10.2         | _(No details provided)_                                                                                              |
| 10.4  | Implement comprehensive error handling                              | Add robust error handling throughout the workflow to handle various failure scenarios           | pending | 10.3         | _(No details provided)_                                                                                              |
| 10.5  | Implement detailed logging and progress reporting                   | Enhance the workflow with comprehensive logging and progress reporting                          | pending | 10.4         | _(No details provided)_                                                                                              |

